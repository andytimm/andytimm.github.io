xmin = .lower,
xmax = .upper),
color = model) +
geom_dotsinterval(quantiles = 100) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
# mutate(ordered_state = fct_reorder(combined_points$state,
#                                     combined_points$postrat_draw)) %>%
ggplot(aes(y = state,
x = postrat_draw,
color = model) +
geom_dotsinterval(quantiles = 100) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
# mutate(ordered_state = fct_reorder(combined_points$state,
#                                     combined_points$postrat_draw)) %>%
ggplot(aes(y = state,
x = postrat_draw,
color = model)) +
geom_dotsinterval(quantiles = 100) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
# mutate(ordered_state = fct_reorder(combined_points$state,
#                                     combined_points$postrat_draw)) %>%
ggplot(aes(y = state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 100) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
# mutate(ordered_state = fct_reorder(combined_points$state,
#                                     combined_points$postrat_draw)) %>%
ggplot(aes(y = state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
# mutate(ordered_state = fct_reorder(combined_points$state,
#                                     combined_points$postrat_draw)) %>%
ggplot(aes(y = state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
mean(combined_points$postrat_draw))) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points)
combined_points %>%
group_by(state,model) %>%
mutate(state_model_mean = mean(postrat_draw)) %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
group_by(state,model) %>%
mutate(state_model_mean = mean(postrat_draw))
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
group_by(state,model,.draw) %>%
mutate(state_model_mean = mean(postrat_draw))
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
group_by(state) %>%
mutate(state_model_mean = mean(postrat_draw))
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw))
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model)
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 50) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>% bind_rows(mfvi_state_points) %>%
mutate(state_model_mean = mean(postrat_draw)) %>% ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$state_model_mean)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 100) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>%
bind_rows(mfvi_state_points) %>%
ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 100) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>%
bind_rows(mfvi_state_points) %>%
ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 100) +
facet_wrap(~model) +
theme(legend.position="none")
mcmc_state_summary <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
mutate(postrat_draw = sum(.epred*(n/sum(n)))) %>%
group_by(state) %>%
median_qi(postrat_draw, .width = c(.5,.95)) %>%
mutate(model = "mcmc")
mfvi_state_summary <- mfvi_state_level %>%
group_by(state,.draw) %>%
mutate(postrat_draw = sum(.epred*(n/sum(n)))) %>%
group_by(state) %>%
median_qi(postrat_draw, .width = c(.5,.95)) %>%
mutate(model = "MF-VI")
combined_summary <- bind_rows(mcmc_state_summary,mfvi_state_summary)
combined_summary %>%
mutate(ordered_state = fct_reorder(combined_summary$state,
combined_summary$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
xmin = .lower,
xmax = .upper,
color = model)) +
geom_pointinterval(position = position_dodge(1)) +
xlim(.25,.75) +
theme(legend.position="top")
mcmc_state_level %>% count
mcmc_state_level %>% ungroup() %>% count
mfvi_state_level %>% ungroup() %>% count
mcmc_state_level <- poststrat_df_60k %>% add_epred_draws(mcmc_60k)
mfvi_state_level <- poststrat_df_60k %>% add_epred_draws(meanfield_60k, ndraws = 4000)
mcmc_state_level <- poststrat_df_60k %>% add_epred_draws(mcmc_60k, ndraws = 1000)
mfvi_state_level <- poststrat_df_60k %>% add_epred_draws(meanfield_60k, ndraws = 1000)
mcmc_state_level %>% glimpse()
mcmc_state_summary <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
mutate(postrat_draw = sum(.epred*(n/sum(n)))) %>%
group_by(state) %>%
median_qi(postrat_draw, .width = c(.5,.95)) %>%
mutate(model = "mcmc")
mfvi_state_summary <- mfvi_state_level %>%
group_by(state,.draw) %>%
mutate(postrat_draw = sum(.epred*(n/sum(n)))) %>%
group_by(state) %>%
median_qi(postrat_draw, .width = c(.5,.95)) %>%
mutate(model = "MF-VI")
combined_summary <- bind_rows(mcmc_state_summary,mfvi_state_summary)
combined_summary %>%
mutate(ordered_state = fct_reorder(combined_summary$state,
combined_summary$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
xmin = .lower,
xmax = .upper,
color = model)) +
geom_pointinterval(position = position_dodge(1)) +
xlim(.25,.75) +
theme(legend.position="top")
mcmc_state_points <- mcmc_state_level %>%
# multiply each draw by it's cell's proportion of state N
# this is the P in MRP
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "mcmc")
mfvi_state_points <- mfvi_state_level %>%
group_by(state,.draw) %>%
summarize(postrat_draw = sum(.epred*(n/sum(n)))) %>%
mutate(model = "MF-VI")
combined_points <- mcmc_state_points %>%
bind_rows(mfvi_state_points) %>%
ungroup()
combined_points %>%
mutate(ordered_state = fct_reorder(combined_points$state,
combined_points$postrat_draw)) %>%
ggplot(aes(y = ordered_state,
x = postrat_draw,
color = model)) +
stat_dots(quantiles = 100) +
facet_wrap(~model) +
theme(legend.position="none")
